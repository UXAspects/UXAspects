<ux-facet-header [header]="header" [(expanded)]="expanded"></ux-facet-header>

<div class="facet-typeahead-list-container" *ngIf="expanded">

    <div class="facet-typeahead-list-selected-container" *ngIf="suggestions?.length > 0">

    <ux-facet-typeahead-list-item
        *ngFor="let facet of suggestions; let index = index"
        [facet]="facet"
        [tabbable]="activeIndex === index"
        [selected]="isFacetSelected(facet)"
        (selectedChange)="toggleFacet(index, facet)"
        (keydown)="onKeydown($event)">
    </ux-facet-typeahead-list-item>

    </div>

    <div class="facet-typeahead-list-control">

        <!-- Create Typeahead Control -->
        <input type="text"
            class="form-control"
            [placeholder]="typeaheadConfig?.placeholder"
            [ngModel]="query$ | async"
            (ngModelChange)="query$.next($event); updateTypeahead($event)"
            (keydown)="typeaheadKeyService.handleKey($event, typeahead)"
            (blur)="typeaheadOpen = false">

        <ux-typeahead #typeahead
            [(open)]="typeaheadOpen"
            display="title"
            [options]="typeaheadOptions"
            [optionTemplate]="facetOptionTemplate"
            [selectOnEnter]="true"
            (optionSelected)="select($event)">
        </ux-typeahead>

    </div>

</div>

<ng-template #facetOptionTemplate let-option="option" let-api="api">
    <p class="facet-typeahead-list-option">
        <span [innerHTML]="option.title | facetTypeaheadHighlight: (query$ | async)"></span>
        <span class="facet-typeahead-list-option-count"
            *ngIf="option.count">
            ({{ option.count }})
        </span>
    </p>
</ng-template>