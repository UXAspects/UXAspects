<ux-logical-expression-builder
    [(expression)]="expression"
    [fields]="fields"
    [operators]="operators"
    [logicalOperators]="logicalOperators"
    [localizedStrings]="localizedStrings"
    (validChange)="valid = $event">
</ux-logical-expression-builder>

<p>The expression is <span [ngClass]="valid ? 'text-success' : 'text-error'">{{ valid ? 'valid' : 'invalid' }}</span>.
</p>

<div class="m-t-md">
    <button type="button" class="btn button-secondary" (click)="resetExpression()">
        Reset expression
    </button>
</div>

<h4>Expression</h4>

<pre class="logical-expression-builder-preview">{{ expression | json }}</pre>

<hr>

<p>
    The Logical Expression Builder provides a visual way for users to build and modify logical expressions. These
    expressions consist of one or more conditions that are linked with logical operators. The result is a tree-like
    expression.
</p>

<p>
    Each condition consists of a data field, an operator, and a value. Each field is associated with a field type, which
    in turn is associated with a list of operators that can be used on this field type. Each operator defines a
    component that is used to present an input element for the value.
</p>

<p>
    The following properties can be used to interact with and configure the Logical Expression Builder:
</p>

<uxd-api-properties tableTitle="Inputs">
    <tr uxd-api-property name="expression" type="LogicalExpression">
        The expression to display in the Logical Expression Builder.
    </tr>

    <tr uxd-api-property name="fields" type="FieldDefinition[]" [required]="true">
        The data fields that can be used to build the expression.
    </tr>

    <tr uxd-api-property name="operators" type="OperatorDefinitionList" [required]="true">
        The operators that can be used to build the expression. The object should contain field types as keys and
        arrays of operators as values.
    </tr>

    <tr uxd-api-property name="logicalOperators" type="LogicalOperatorDefinition[]">
        The logical operators that can be used to build the expression. The default operators are
        <code>and</code>, <code>or</code>, and <code>not</code>.
    </tr>

    <tr uxd-api-property name="localizedStrings" type="LocalizedStrings">
        A collection of custom localized strings that are used for display or accessibility in the Logical Expression
        Builder.
    </tr>

    <tr uxd-api-property name="displayValueFunction"
        type="(value: any, fieldType?: string, fieldData?: any) => string">
        A function used to display the values of conditions that are not in edit mode.

        <uxd-snippet [content]="snippets.compiled.displayValueFunctionTs"></uxd-snippet>
    </tr>
</uxd-api-properties>

<uxd-api-properties tableTitle="Outputs">
    <tr uxd-api-property name="expressionChange" type="LogicalExpression">
        Emits whenever the expression has been modified. It will contain the latest expression value.
    </tr>

    <tr uxd-api-property name="validChange" type="boolean">
        Emits whenever the validity of the expression changes. A value of <code>true</code> signifies the
        expression is valid, whereas <code>false</code> signifies it is invalid.
    </tr>
</uxd-api-properties>

<uxd-api-properties tableTitle="Fields">
    <tr uxd-api-property name="name" type="string" [required]="true">
        The name used to identify the field.
    </tr>

    <tr uxd-api-property name="label" type="string" [required]="true">
        The text that is displayed to the user.
    </tr>

    <tr uxd-api-property name="fieldType" type="string" [required]="true">
        The type of the field. Used for associating fields and operators.
    </tr>

    <tr uxd-api-property name="configuration" type="object">
        An object containing configuration options for the Input Components, e.g. options for the Select Input Component
        or a function for validating user input.
    </tr>
</uxd-api-properties>

<uxd-snippet [content]="snippets.compiled.fieldsDefinitionTs"></uxd-snippet>

<uxd-api-properties tableTitle="Operators">
    <tr uxd-api-property name="name" type="string" [required]="true">
        The name used to identify the operator.
    </tr>

    <tr uxd-api-property name="label" type="string" [required]="true">
        The text that is displayed to the user.
    </tr>

    <tr uxd-api-property name="component" type="any" [required]="true">
        The class of the Input Component that should be used for user input.
    </tr>
</uxd-api-properties>

<uxd-snippet [content]="snippets.compiled.operatorsDefinitionTs"></uxd-snippet>

<uxd-api-properties tableTitle="Logical Operators">
    <tr uxd-api-property name="name" type="string" [required]="true">
        The name used to identify the logical operator.
    </tr>

    <tr uxd-api-property name="label" type="string" [required]="true">
        The text that is displayed to the user.
    </tr>

    <tr uxd-api-property name="minNumberOfChildren" type="number">
        The minimum number of children the logical operator should have.
    </tr>

    <tr uxd-api-property name="maxNumberOfChildren" type="number">
        The maximum number of children the logical operator should have.
    </tr>

    <tr uxd-api-property name="errorMessage" type="string">
        The error message that should be displayed if the number of children is not within the set boundaries.
    </tr>
</uxd-api-properties>

<uxd-snippet [content]="snippets.compiled.logicalOperatorsDefinitionTs"></uxd-snippet>

<h4>Localization</h4>

<p>
    The Logical Expression Builder can receive an object containing translation keys as properties and the respective
    translations for all text and accessibility labels. If provided, the contained strings will replace the defaults in
    English. The keys that can be overridden are:
</p>

<uxd-snippet [content]="snippets.compiled.localizedStringsTs"></uxd-snippet>

<h4>Input Components</h4>

<p>
    The Logical Expression Builder comes with the following predefined components for entering values of common data
    types. The <code>configuration</code> object is defined in the <code>fields</code> object of the Logical Expression
    Builder
    (see example below).
</p>

<h4>Date Input Component</h4>

<p>
    Contains a date picker. It expects a value of type <code>Date</code>. The <code>configuration</code> can contain the
    following properties:
</p>

<uxd-api-properties>
    <tr uxd-api-property name="showTime" type="boolean">
        Whether the date picker will also display time input. Defaults to <code>false</code>.
    </tr>

    <tr uxd-api-property name="showNowBtn" type="boolean">
        Whether the date picker will display a 'Now' button. Defaults to <code>false</code>.
    </tr>

    <tr uxd-api-property name="dateFormat" type="string">
        The format dates will be displayed in. The pre-defined date formats can be found at
        <a href="https://angular.io/api/common/DatePipe#pre-defined-format-options">Date Pipe</a> format options.
        Defaults to <code>'short'</code>.
    </tr>

    <tr uxd-api-property name="validateFunction" type="(value: Date) => boolean">
        The function that is used to validate user input.
    </tr>
</uxd-api-properties>

<h4>Date Range Input Component</h4>

<p>
    Contains a date range picker. It expects an object of the form <code>{{ '{ start: Date, end: Date }' }}</code>
    as a value. The <code>configuration</code> can contain the following properties:
</p>

<uxd-api-properties>
    <tr uxd-api-property name="showTime" type="boolean">
        Whether the date range picker will also display time input. Defaults to <code>false</code>.
    </tr>

    <tr uxd-api-property name="showNowBtn" type="boolean">
        Whether the date range picker will display a 'Now' button. Defaults to <code>false</code>.
    </tr>

    <tr uxd-api-property name="dateFormat" type="string">
        The format dates will be displayed in. The pre-defined date formats can be found at
        <a href="https://angular.io/api/common/DatePipe#pre-defined-format-options">Date Pipe</a> format options.
        Defaults to <code>'short'</code>.
    </tr>

    <tr uxd-api-property name="validateFunction" type="(value: { start: Date, end: Date }) => boolean">
        The function that is used to validate user input.
    </tr>
</uxd-api-properties>

<h4>Number Input Component</h4>

<p>
    Contains a number picker. It expects a value of type <code>number</code>. The <code>configuration</code> can contain
    the following properties:
</p>

<uxd-api-properties>
    <tr uxd-api-property name="min" type="number">
        The smallest number that can be entered in the number picker.
    </tr>

    <tr uxd-api-property name="max" type="number">
        The largest number that can be entered in the number picker.
    </tr>

    <tr uxd-api-property name="validateFunction" type="(value: number) => boolean">
        The function that is used to validate user input.
    </tr>
</uxd-api-properties>

<h4>Select Input Component</h4>

<p>
    Contains a select input. It expects a value of type <code>string[]</code>, containing the <code>name</code>
    of one or more options. The <code>configuration</code> can contain the following properties:
</p>

<uxd-api-properties>
    <tr uxd-api-property name="options" [required]="true">
        The options for the select input.

        <ul>
            <li>
                <code>name: string</code> - The name used to identify the option.
            </li>
            <li>
                <code>label: string</code> - The text that is displayed to the user.
            </li>
            <li>
                <code>icon?: string</code> - Optionally, the name of a <code>ux-icon</code> that is displayed for the
                option.
            </li>
        </ul>
    </tr>

    <tr uxd-api-property name="validateFunction" type="(value: string[]) => boolean">
        The function that is used to validate user input.
    </tr>
</uxd-api-properties>

<h4>Text Input Component</h4>

<p>
    Contains a simple text input, expecting a value of type <code>string</code>. The <code>configuration</code> can
    contain the following properties:
</p>

<uxd-api-properties>
    <tr uxd-api-property name="validateFunction" type="(value: string) => boolean">
        The function that is used to validate user input.
    </tr>
</uxd-api-properties>


<h4>Custom Input Components</h4>

<p>
    In addition to the predefined Input Components, it is also possible to implement Custom Input Components. These must
    have the following inputs and outputs:
</p>

<uxd-api-properties tableTitle="Inputs">
    <tr uxd-api-property name="value" type="any">
        The value of the respective condition.
    </tr>

    <tr uxd-api-property name="configuration" type="any">
        The configuration options for the custom component, e.g. the available options in a select dropdown. This is
        defined in the <code>fields</code> input of
        <code>&lt;ux-logical-expression-builder&gt;</code>.
    </tr>
</uxd-api-properties>

<uxd-api-properties tableTitle="Outputs">
    <tr uxd-api-property name="valueChange" type="any">
        Emits whenever the value has been modified.
    </tr>
    <tr uxd-api-property name="validChange" type="boolean">
        Emits whenever the validity of the value has changed. It will contain <code>true</code> if the
        value is valid, and <code>false</code> if it is not.
    </tr>
</uxd-api-properties>

<h4>Example of a Custom Input Component</h4>

<p>
    Below is an example for a Custom Input Component containing a <code>textarea</code> input. In this specific case,
    the <code>configuration</code> object is used to pass a <code>maxHeight</code> for the input.
</p>

<ux-tabset [minimal]="false">
    <ux-tab heading="HTML">
        <uxd-snippet [content]="snippets.compiled.textareaInputComponentHtml"></uxd-snippet>
    </ux-tab>
    <ux-tab heading="TypeScript">
        <uxd-snippet [content]="snippets.compiled.textareaInputComponentTs"></uxd-snippet>
    </ux-tab>
</ux-tabset>

<h4>Example Code</h4>

<p>
    Below is an example of how the Logical Expression Builder can be used.
</p>

<ux-tabset [minimal]="false">
    <ux-tab heading="HTML">
        <uxd-snippet [content]="snippets.compiled.appHtml"></uxd-snippet>
    </ux-tab>
    <ux-tab heading="TypeScript">
        <uxd-snippet [content]="snippets.compiled.appTs"></uxd-snippet>
    </ux-tab>
</ux-tabset>
