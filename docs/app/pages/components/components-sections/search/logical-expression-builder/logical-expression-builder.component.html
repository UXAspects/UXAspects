<ux-logical-expression-builder
    [(expression)]="expression"
    [fields]="fields"
    [operators]="operators"
    [logicalOperators]="logicalOperators"
    [localizedStrings]="localizedStrings"
    (valid)="valid = $event">
</ux-logical-expression-builder>

<p>The expression is <span [ngClass]="valid ? 'text-success' : 'text-error'">{{ valid ? 'valid' : 'invalid' }}</span>.</p>

<div class="m-t-md">
    <button type="button" class="btn button-secondary" (click)="resetExpression()">
        Reset expression
    </button>
</div>

<h4>Expression</h4>

<pre class="logical-expression-builder-preview">{{ expression | json }}</pre>

<hr>

<p>
    The Logical Expression Builder provides a visual way for users to build and modify logical expressions. These
    expressions consist of one or more conditions that are linked with logical operators. The result is a tree-like
    expression.
</p>

<p>
    Each condition consists of a data field, an operator, and a value. Each field is associated with a field type, which
    in turn is associated with a list of operators that can be used on this field type. Each operator defines a
    component that is used to present an input element for the value.
</p>

<p>
    The following properties can be used to interact with and configure the Logical Expression Builder:
</p>

<uxd-api-properties tableTitle="Inputs">
    <tr uxd-api-property name="expression" type="LogicalExpressionBuilderExpression">
        If defined, the Logical Expression Builder will be filled with this expression.
    </tr>

    <tr uxd-api-property name="fields" type="FieldDefinition[]" [required]="true">
        Contains the data fields that can be used to build the expression.
    </tr>

    <tr uxd-api-property name="operators" type="OperatorDefinitionList" [required]="true">
        Contains the operators that can be used to build the expression.
    </tr>

    <tr uxd-api-property name="logicalOperators" type="LogicalOperatorDefinition[]">
        Contains the logical operators that can be used to build the expression. The default operators are
        <code>and</code>, <code>or</code>, and <code>not</code>.
    </tr>

    <tr uxd-api-property name="localizedStrings" type="{ [key: string]: string }">
        This object can be used to provide custom localized strings that are used for display or accessibility in the
        Logical Expression Builder.
    </tr>

    <tr uxd-api-property name="displayValueFunction"
        type="(value: any, fieldType?: string, fieldData?: any) => string">
        If provided, this function is used to display the values of conditions that are not in edit mode.
    </tr>
</uxd-api-properties>

<uxd-api-properties tableTitle="Outputs">
    <tr uxd-api-property name="expressionChange" type="LogicalExpressionBuilderExpression">
        This event will fire whenever the expression has been modified. It will contain the latest expression value.
    </tr>

    <tr uxd-api-property name="valid" type="boolean">
        This event will fire whenever the validity of the expression changes. A value of <code>true</code> signifies the
        expression is valid, whereas <code>false</code> signifies it is invalid.
    </tr>
</uxd-api-properties>

<h4>Configuration</h4>

<p>
    The <code>fields</code> property expects an array of <code>FieldDefinition</code> objects, each of which will be an
    option in the select input for choosing a field for a condition. Each object has <code>name</code> property, which
    is used in the generated expression, a <code>label</code> property, which contains the string displayed in the UI,
    and a <code>fieldType</code>, which is used for associating the field with its operators.
</p>

<p>
    Additionally, the object can contain a <code>data</code> property, which is used to pass data to the Input
    Component. It can contain, e.g., options for a select input, or <code>min</code> and <code>max</code> values for a
    number picker. A <code>validateFunction</code> with the signature <code>(value: any) => boolean</code> can also be
    passed in the <code>data</code> object. It is used to check the validity of a value entered in an Input Component
    associated with the field.
</p>

<uxd-snippet [content]="snippets.compiled.fieldsDefinitionTs"></uxd-snippet>

<p>
    The <code>operators</code> property expects an object of type <code>OperatorDefinitionList</code>. This object
    contains the field types defined in <code>fields</code> as property names. Each of these properties is an array of
    operator definition.
</p>

<p>
    Each operator has a <code>name</code> that is used in the generated expression, a <code>label</code> that is used in
    the UI, and a <code>component</code> property, which defines which Input Component will be rendered if the operator
    is selected. It is possible to have operators with different Input Components for the same field type.
</p>

<uxd-snippet [content]="snippets.compiled.operatorsDefinitionTs"></uxd-snippet>

<p>
    The <code>logicalOperators</code> property defines which logical operators are available in the Logical Expression
    Builder. It is an array of type <code>LogicalOperatorDefinition</code>, in which each object has a <code>name</code>
    and <code>label</code> property, for the generated expression and the UI, respectively. Additionally, <code>minNumberOfChildren</code>
    or <code>maxNumberOfChildren</code> can be set to display an error if the respective logical operator has a wrong
    number of children. This error message can also be defined.
</p>

<p>
    If no <code>logicalOperators</code> property is provided, the default operators <code>and</code>, <code>or</code>,
    and <code>not</code> are used.
</p>

<uxd-snippet [content]="snippets.compiled.logicalOperatorsDefinitionTs"></uxd-snippet>

<p>
    The <code>displayValueFunction</code> property provides a way to customize how values are displayed in the Logical
    Expression Builder if a condition is not being edited. It expects a function that takes a value as an argument and
    transforms it into a string. Optionally, it can also take the arguments <code>fieldType</code> and
    <code>fieldData</code> to further customize the display logic.
</p>

<uxd-snippet [content]="snippets.compiled.displayValueFunctionTs"></uxd-snippet>

<h4>Localization</h4>

<p>
    The Logical Expression Builder can receive an object containing translation keys as properties and the respective
    translations for all text and accessibility labels. If provided, the contained strings will replace the defaults in
    English. The keys that can be overridden are:
</p>

<uxd-snippet [content]="snippets.compiled.localizedStringsTs"></uxd-snippet>

<h4>Input Components</h4>

<p>
    The Logical Expression Builder comes with the following predefined components for entering values of common data
    types. The <code>data</code> object is defined in the <code>fields</code> object of the Logical Expression Builder
    (see example below).
</p>

<uxd-api-properties>
    <tr uxd-api-property name="DateInputComponent">
        <p>
            Contains a date picker. It expects a value of type <code>number</code>, representing milliseconds since
            January 1 1970, 12:00 AM. The <code>data</code> can contain the following properties:
        </p>

        <ul>
            <li>
                <code>showTime: boolean</code> - If specified, the date picker will also display time input. Defaults to
                <code>false</code>.
            </li>
            <li>
                <code>dateFormat: string</code> - The format dates will be displayed in. Defaults to
                <code>'medium'</code>.
            </li>
        </ul>
    </tr>

    <tr uxd-api-property name="DateRangeInputComponent">
        <p>
            Contains a date range picker. It expects an object of the form
            <code>{{ '{ start: number, end: number }' }}</code>
            as a value, where each property represents a date in milliseconds since January 1 1970, 12:00 AM. The <code>data</code>
            can contain the following properties:
        </p>

        <ul>
            <li>
                <code>showTime: boolean</code> - If specified, the date picker will also display time input. Defaults to
                <code>false</code>.
            </li>
            <li>
                <code>dateFormat: string</code> - The format dates will be displayed in. Defaults to
                <code>'medium'</code>.
            </li>
        </ul>
    </tr>

    <tr uxd-api-property name="NumberInputComponent">
        <p>
            Contains a number picker. It expects a value of type <code>number</code>. The <code>data</code> can contain
            the following properties:
        </p>

        <ul>
            <li>
                <code>min: number</code> - The smallest number that can be entered in the date picker.
            </li>
            <li>
                <code>max: number</code> - The largest number that can be entered in the date picker.
            </li>
        </ul>
    </tr>

    <tr uxd-api-property name="SelectInputComponent">
        <p>
            Contains a select input. It expects a value of type <code>string[]</code>, containing the <code>name</code>
            of one or more options. The options for the select input can be provided in using the <code>options</code>
            property of the <code>data</code>. Each option needs the
            following properties:
        </p>

        <ul>
            <li>
                <code>name: string</code> - A unique identifier for the option.
            </li>
            <li>
                <code>label: string</code> - The text that is displayed in the UI.
            </li>
            <li>
                <code>icon?: string</code> - Optionally, the name of a <code>ux-icon</code> that is displayed for this
                option.
            </li>
        </ul>
    </tr>

    <tr uxd-api-property name="TextInputComponent">
        <p>
            Contains a simple text input, expecting a value of type <code>string</code>. This Input Component does not
            need a <code>data</code> object.
        </p>
    </tr>
</uxd-api-properties>

<h4>Custom Input Components</h4>

<p>
    In addition to the predefined Input Components, it is also possible to built custom input components. These must
    conform with the following interfaces:
</p>

<uxd-api-properties tableTitle="Outputs">
    <tr uxd-api-property name="value" type="any">
        Contains the value of the respective condition.
    </tr>

    <tr uxd-api-property name="data" type="any">
        Contains the data for the specific <code>field</code> defined in the fields definition. E.g., it can be used
        to pass options for a select input, or any additional data the input component needs that depends on the
        specific field.
    </tr>
</uxd-api-properties>

<uxd-api-properties tableTitle="Outputs">
    <tr uxd-api-property name="valueChange" type="any">
        This event will fire whenever the value has been modified. It will contain the latest value.
    </tr>
</uxd-api-properties>

<h4>Example for a custom Input Component</h4>

<p>
    Below is an example for a custom Input Component containing a <code>textarea</code> input. In this specific case,
    the <code>data</code> object is used to pass a <code>maxHeight</code> for the input.
</p>

<ux-tabset [minimal]="false">
    <ux-tab heading="HTML">
        <uxd-snippet [content]="snippets.compiled.textareaInputComponentHtml"></uxd-snippet>
    </ux-tab>
    <ux-tab heading="TypeScript">
        <uxd-snippet [content]="snippets.compiled.textareaInputComponentTs"></uxd-snippet>
    </ux-tab>
</ux-tabset>

<h4>Example Code</h4>

<ux-tabset [minimal]="false">
    <ux-tab heading="HTML">
        <uxd-snippet [content]="snippets.compiled.appHtml"></uxd-snippet>
    </ux-tab>
    <ux-tab heading="TypeScript">
        <uxd-snippet [content]="snippets.compiled.appTs"></uxd-snippet>
    </ux-tab>
</ux-tabset>
